FROM python:3.9-slim

WORKDIR /app

# Install dependencies
RUN pip install mysql-connector-python requests python-dateutil fastapi uvicorn

# Copy shared database pool module
COPY src/shared /app/shared

# Copy the fixed materialized updater
COPY materialized_updater_fixed.py /app/

# Set environment variables
ENV PYTHONPATH=/app

# Set the command
CMD ["python", "materialized_updater_fixed.py", "--continuous", "--interval", "5"]