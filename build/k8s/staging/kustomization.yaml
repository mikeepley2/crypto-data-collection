apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: crypto-staging-kustomization

namespace: crypto-staging

namePrefix: staging-

commonLabels:
  environment: staging
  app.kubernetes.io/instance: crypto-staging

resources:
- ../base/namespace.yaml
- ../base/configmap.yaml
- ../base/rbac-and-policies.yaml
- ../base/news-collector.yaml
- ../base/sentiment-ml.yaml
- ../base/technical-calculator.yaml
- ../base/materialized-updater.yaml

patchesStrategicMerge:
- namespace-patch.yaml
- scaling-patch.yaml

configMapGenerator:
- name: crypto-config-staging
  literals:
  - ENVIRONMENT=staging
  - LOG_LEVEL=DEBUG
  - NEWS_COLLECTION_INTERVAL=600  # Longer intervals for staging
  - SENTIMENT_PROCESSING_INTERVAL=600
  - TECHNICAL_CALCULATION_INTERVAL=1800
  - MATERIALIZED_REFRESH_INTERVAL=600

images:
- name: crypto/enhanced-news-collector
  newTag: staging-latest
- name: crypto/enhanced-sentiment-ml
  newTag: staging-latest
- name: crypto/enhanced-technical-calculator
  newTag: staging-latest
- name: crypto/enhanced-materialized-updater
  newTag: staging-latest